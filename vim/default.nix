# Vim, with a set of extra packages (extraPackages) and a custom vimrc
# (./vimrc). The final vimrc file is generated by vimUtils.vimrcFile and
# bundles all the packages with the custom vimrc.
{ symlinkJoin, makeWrapper, vim_configurable, vimUtils, vimPlugins }:
let
  extraPackages = with vimPlugins;
    [
      # TODO: setup ultisnips and vim-snippets
      UltiSnips

      # TODO: vim-beancount
      # TODO: SimplylFold (python folding for vim)
      gitgutter  # show diffs in status
      nerdcommenter  # comment manipulation
      surround  # delimiter (quote, brace, etc) manipulation

      # syntastic  # linting
      ale  # better linting

      tabular  # format tables
      vim-easymotion  # upgraded search
      vim-indent-guides  # show indents visually
      youcompleteme  # completion is life
      # language support (and linting) packages:
      vim-json  # vim-jdaddy not available
      vim-markdown
      vim-nix

      # TODO: these packages *seem* like a good idea; audition and learn them
      #ctrlp # grep -Er from inside Vim
      #fugitive  # frob Git from inside Vim
      #tmux-navigator
      #nerdtree  # file browser from inside Vim
      #vim-airline  # status bar

      # NOTE: intriguing packages which I'm still not sure are a good idea
      #vim-trailing-whitespace
      #vimproc
    ];
  customRC = vimUtils.vimrcFile
    { customRC = builtins.readFile ./vimrc;
      packages.mvc.start = extraPackages;
    };
in
symlinkJoin {
  name = "vim";
  buildInputs = [makeWrapper];
  postBuild = ''
    wrapProgram "$out/bin/vim" \
    --add-flags "-u ${customRC}"
  '';
  paths = [ vim_configurable ];
}
