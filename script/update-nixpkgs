#!/usr/bin/env nix-shell
#!nix-shell -I nixpkgs=./nixpkgs
#!nix-shell -i bash
#!nix-shell -p bash nix curl jq
#!nix-shell --pure
# vim: filetype=sh
# Updates the nixpkgs.json to the latest release
# See https://gist.github.com/zimbatm/de5350245874361762b6a4dfe5366530
set -euo pipefail

branch=master
owner=NixOS
repo=nixpkgs

rev=$(curl -sfL https://api.github.com/repos/$owner/$repo/git/refs/heads/$branch | jq -r .object.sha)
url=https://github.com/$owner/$repo/archive/$rev.tar.gz

release_sha256=$(nix-prefetch-url --unpack "$url")

cat <<NIXPKGS | tee nixpkgs/nixpkgs-src.json
{
  "owner": "$owner",
  "repo": "$repo",
  "rev": "$rev",
  "sha256": "$release_sha256"
}
NIXPKGS
